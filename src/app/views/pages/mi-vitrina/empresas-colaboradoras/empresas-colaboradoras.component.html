<!-- Empresas Colaboradoras Component -->
<div class="page-header">
  <h3 class="page-title">
    <i class="feather icon-briefcase"></i>
    Empresas colaboradoras
  </h3>
</div>

<!-- Info -->
<div class="info-tip mb-4">
  <i class="feather icon-info"></i>
  <span>¿Con quién sueles colaborar? Muestra a las parejas las empresas con las que trabajas y llega a más clientes.</span>
</div>

<!-- Estadísticas -->
<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="stat-card">
      <div class="stat-icon">
        <i class="feather icon-briefcase"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ totalEmpresas }}</div>
        <div class="stat-label">Empresas colaboradoras</div>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="stat-card">
      <div class="stat-icon active">
        <i class="feather icon-eye"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ empresasVisibles }}</div>
        <div class="stat-label">Empresas visibles</div>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="stat-card">
      <div class="stat-icon">
        <i class="feather icon-trending-up"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ totalColaboraciones }}</div>
        <div class="stat-label">Total colaboraciones</div>
      </div>
    </div>
  </div>
</div>

<!-- Buscar y agregar -->
<div class="search-add-section mb-4">
  <div class="search-box">
    <i class="feather icon-search"></i>
    <input 
      type="text" 
      class="form-control" 
      [(ngModel)]="busqueda"
      placeholder="Escribe el nombre de la empresa con la que colaboras"
    >
  </div>
  <button class="btn btn-crear" (click)="abrirFormulario()">
    <i class="feather icon-plus"></i>
    Agregar Empresa
  </button>
</div>

<!-- Formulario -->
@if (mostrarFormulario) {
  <div class="formulario-empresa mb-4">
    <div class="card">
      <div class="card-header">
        <h5>{{ empresaEditando ? 'Editar Empresa' : 'Nueva Empresa Colaboradora' }}</h5>
        <button class="btn-close-form" (click)="cerrarFormulario()">
          <i class="feather icon-x"></i>
        </button>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Nombre de la empresa *</label>
            <input 
              type="text" 
              class="form-control" 
              [(ngModel)]="nuevaEmpresa.nombre"
              placeholder="Ej: Dj Mimo"
            >
          </div>

          <div class="col-md-6">
            <label class="form-label">Categoría / Servicio *</label>
            <select class="form-select" [(ngModel)]="nuevaEmpresa.categoria">
              <option value="">Selecciona una categoría</option>
              @for (cat of categorias; track cat) {
                <option [value]="cat">{{ cat }}</option>
              }
            </select>
          </div>

          <div class="col-md-6">
            <label class="form-label">URL de la foto *</label>
            <input 
              type="url" 
              class="form-control" 
              [(ngModel)]="nuevaEmpresa.foto"
              placeholder="https://..."
            >
          </div>

          <div class="col-md-6">
            <label class="form-label">Número de colaboraciones</label>
            <input 
              type="number" 
              class="form-control" 
              [(ngModel)]="nuevaEmpresa.colaboraciones"
              min="0"
            >
          </div>
        </div>

        <div class="form-actions">
          <button class="btn btn-secondary" (click)="cerrarFormulario()">
            Cancelar
          </button>
          <button class="btn btn-primary" (click)="guardarEmpresa()">
            <i class="feather icon-save"></i>
            {{ empresaEditando ? 'Actualizar' : 'Agregar' }}
          </button>
        </div>
      </div>
    </div>
  </div>
}

<!-- Lista de empresas -->
<div class="empresas-grid">
  @for (empresa of empresasFiltradas; track empresa.id) {
    <div class="empresa-card" [class.oculta]="!empresa.visible">
      <div class="empresa-foto">
        <img [src]="empresa.foto" [alt]="empresa.nombre">
      </div>
      
      <div class="empresa-header">
        <div class="empresa-info-principal">
          <h5 class="empresa-nombre">{{ empresa.nombre }}</h5>
          @if (empresa.colaboraciones > 0) {
            <span class="colaboraciones-badge">
              <i class="feather icon-briefcase"></i>
              {{ empresa.colaboraciones }}
            </span>
          }
        </div>
        
        <div class="empresa-actions">
          <button 
            class="btn-icon"
            [class.active]="empresa.visible"
            (click)="toggleVisibilidad(empresa)"
            [title]="empresa.visible ? 'Ocultar' : 'Mostrar'"
          >
            <i [class]="empresa.visible ? 'feather icon-eye' : 'feather icon-eye-off'"></i>
          </button>
          <button class="btn-icon" (click)="editarEmpresa(empresa)" title="Editar">
            <i class="feather icon-edit"></i>
          </button>
          <button class="btn-icon danger" (click)="eliminarEmpresa(empresa)" title="Eliminar">
            <i class="feather icon-trash-2"></i>
          </button>
        </div>
      </div>

      <div class="empresa-detalles">
        <div class="detalle-item">
          <i class="feather icon-tag"></i>
          <span>{{ empresa.categoria }}</span>
        </div>
      </div>

      @if (empresa.colaboraciones > 0) {
        <div class="empresa-colaboraciones">
          <button class="btn-colaboracion" (click)="decrementarColaboraciones(empresa)">
            <i class="feather icon-minus"></i>
          </button>
          <span class="colaboraciones-numero">
            {{ empresa.colaboraciones }} colaboración{{ empresa.colaboraciones !== 1 ? 'es' : '' }}
          </span>
          <button class="btn-colaboracion" (click)="incrementarColaboraciones(empresa)">
            <i class="feather icon-plus"></i>
          </button>
        </div>
      } @else {
        <div class="empresa-footer">
          <button class="btn btn-sm btn-outline" (click)="incrementarColaboraciones(empresa)">
            <i class="feather icon-plus"></i>
            Agregar colaboración
          </button>
        </div>
      }

      @if (!empresa.visible) {
        <div class="overlay-oculta">
          <span class="badge-oculta">
            <i class="feather icon-eye-off"></i>
            Oculta
          </span>
        </div>
      }
    </div>
  }
</div>

<!-- Empty state -->
@if (empresasFiltradas.length === 0 && busqueda) {
  <div class="empty-state">
    <i class="feather icon-search"></i>
    <h5>No se encontraron empresas</h5>
    <p>No hay empresas colaboradoras que coincidan con "{{ busqueda }}"</p>
  </div>
}

@if (empresas.length === 0) {
  <div class="empty-state">
    <i class="feather icon-briefcase"></i>
    <h5>No hay empresas colaboradoras</h5>
    <p>Agrega las empresas con las que colaboras para mostrarlas a las parejas</p>
    <button class="btn btn-primary" (click)="abrirFormulario()">
      <i class="feather icon-plus"></i>
      Agregar Primera Empresa
    </button>
  </div>
}
